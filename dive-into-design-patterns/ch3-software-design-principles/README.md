# 软件设计原则

## 优秀设计的特征

### 代码复用

无论是开发何种软件产品，成本和时间都是最重要的两个维度。

**代码复用**是减少开发成本时最常用的方式之一。

设计模式创始人之一的**埃里希 伽玛**认为复用有三层：

- 最底层：复用类（类库、容器及一些类的组合等等）
- 中间层：设计模式。比框架更小且更抽象，它们实际上是对一组类的关系及其互动方式的描述。
- 最高层：框架。用于精简自己的设计，可以用于明确解决问题所需的抽象概念，然后用类来表示这些概念并定义其关系。

**当你从类转向模式，并最终到达框架的过程中，复用程度会不断增加**

### 扩展性

**变化**是程序员生命中唯一不变的事情。

在设计程序架构时，所有有经验的开发者会尽量选择支持未来任何可能变更的方式。

## 设计原则

### 封装变化的内容

**找到程序中变化内容并将其与不变的内容区分开**

该原则的主要目的是将变更造成的影响最小化。

将变化部分放入对立的模块中，保护其他代码不受负面影响。

### 面向接口进行开发，而不是面向实现

**面向接口进行开发，而不是面向实现；依赖于抽象类型，而不是具体类**

如果无需修改已有代码就能轻松对类进行扩展，那就可以说这样的设计是灵活的。

### 组合优于继承

继承可能是类之间最明显、最简便的代码复用方式。

（如果你的代码有相同的类，就可以为它们创建一个通用的基类，然后将相似的代码移动到其中）

继承的问题清单：

- **子类不能减少超类的接口**。必须实现父类中所有的抽象方法。
- **在重写方法时，你需要确保新行为与其基类中的版本兼容**。因为子类的成员都可能被传递给以超类对象为参数的任何代码，若不兼容将会导致这些代码崩溃。
- **继承打破了超类的封装**，因为子类拥有访问父类内部详细内容的权限。
- **子类与超类紧密耦合**。超类中的任何修改都可能会破坏子类的功能。
- **通过继承复用代码可能导致平行继承体系的产生**。继承通常仅发生在一个维度中。只要出现了两个以上的维度，你就必须创建数量巨大的类组合，从而使类层次结构膨胀到不可思议的程度。

**组合**时替代**继承**的一种方法。继承代表类之间的`是`关系，组合代码类之间的`有`关系。

![](../imgs/ch3-software-design-principles/继承.png)

某公司同时生产汽车 `Car` 和卡车 `Truck`，车辆可能是电动车 `Electric` 或汽油车 `Combustion`；所有车型都配备了手动控制 `manual control` 或自动驾驶 `Autopilot` 功能。

使用组合，汽车对象可将行为委派给其他对象，而不是自行实现。

![](../imgs/ch3-software-design-principles/组合.png)